/*
 * File: app.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.1.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.Loader.setConfig({
    enabled: true
});

Ext.application({
    models: [
        'Notes'
    ],
    stores: [
        'Notes'
    ],
    views: [
        'LoginForm',
        'MainTabPanel'
    ],
    name: 'MyApp',
    controllers: [
        'MyController'
    ],

    launch: function() {

        Ext.create('MyApp.view.LoginForm', {fullscreen: true});
    }

});

//NFC Functionality

var app = {
	    initialize: function () {
	        this.bind();
	    },
	    bind: function () {
	        document.addEventListener('deviceready', this.deviceready, true);
	    },
	    deviceready: function () {
	    
	        function failure(reason) {
	            navigator.notification.alert(reason, function() {}, "There was a problem");
	        }

	        nfc.addNdefListener(
	            app.onNdef,
	            function() {
	            	navigator.notification.alert("Listening for ndef tags", function() {}, "Think NFC");
	                console.log("Listening for NDEF tags.");
	            },
	            failure
	        );
	        
	       /* nfc.addTagDiscoveredListener(
	                app.onNfc,
	                function() {
	                    console.log("Listening for non-NDEF tags.");
	                },
	                failure
	            );*/

	        if (device.platform == "Android") {

	            // Android reads non-NDEF tag. BlackBerry and Windows don't.
	            nfc.addTagDiscoveredListener(
	                app.onNfc,
	                function() {
	                	navigator.notification.alert("Listening for non-ndef tags", function() {}, "Think NFC");
	                    console.log("Listening for non-NDEF tags.");
	                },
	                failure
	            );

	            // Android launches the app when tags with mime type text/pg are scanned
	            // because of an intent in AndroidManifest.xml.
	            // phonegap-nfc fires an ndef-mime event (as opposed to an ndef event)
	            // the code reuses the same onNfc handler
	            nfc.addMimeTypeListener(
	                'text/pg',
	                app.onNdef,
	                function() {
	                    console.log("Listening for NDEF mime tags with type text/pg.");
	                },
	                failure
	            );
	        }

	      /*  app.compileTemplates();
	        app.addTemplateHelpers();
	        app.showInstructions();*/
	    },
	    onNfc: function (nfcEvent) {
	        
	        console.log(JSON.stringify(nfcEvent.tag));

	   /*     tagContents.innerHTML = app.nonNdefTagTemplate(tag);    
	        navigator.notification.vibrate(100);        */
	    },
	    onNdef: function (nfcEvent) {
	        
	        console.log(JSON.stringify(nfcEvent.tag));
	       /* app.clearScreen();*/

	        var tag = nfcEvent.tag;

	        // BB7 has different names, copy to Android names
	        if (tag.serialNumber) {
	            tag.id = tag.serialNumber;
	            tag.isWritable = !tag.isLocked;
	            tag.canMakeReadOnly = tag.isLockable;
	        }

	       /* tagContents.innerHTML = app.tagTemplate(tag);

	        navigator.notification.vibrate(100); */       
	    }
	   
	}


